{% extends 'base.html' %}

{% block head %}
    <title>Test {{ test|capfirst }}</title>
    <!-- Custom styles for this template -->
    {% load static %}
    <link href="{% static 'css/card.css?v=32' %}" rel="stylesheet">
    <script>

    </script>
{% endblock %}

{% block navbar %}
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top border-bottom border-light d-none d-md-block">
        <div class="container">
            {% load static %}
            <a href="{% url 'vocab:index' %}"><img src="{% static 'images/logo.png' %}" type="image/png"></a>
            <a class="navbar-brand" href="{% url 'vocab:index' %}">Shiksha</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                    aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'vocab:index' %}#lecture">
                            <span>Lecture Tests</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'vocab:index' %}#session">
                            <span>Session Tests</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <nav class="d-block d-md-none navbar navbar-expand-lg navbar-dark bg-dark fixed-top border-bottom border-light">
        <div class="container">
            <a class="navbar-brand" href="{% url 'vocab:index' %}">Shiksha</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                    aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'vocab:index' %}#lecture">
                            <span>Lecture Tests</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="{% url 'vocab:index' %}#session">
                            <span>Session Tests</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
{% endblock %}

{% block body %}
    <div id="lecture" class="d-none d-md-block"></div>
    <div class="container mt-2">
        <div class="container">
            <div class="row">
                <div class="col mx-auto">
                    <div class="effect d-none d-md-block" onclick="flip()">
                        <div class="card-container">
                            <div class="card">
                                <div class="front bg-info" style="padding-top: 20%;">
                            <span class="word-style">
                                Loading...
                            </span>
                                </div>
                                <div class="back my-secondary">
                                    <span class="heading-style back-head">Meaning</span>
                                    <p class="text-style back-desc">
                                        ["to choose not to do or have something : to refrain deliberately and often with
                                        an effort of self-denial from an action or practice","to choose not to vote"]}]
                                    </p>
                                    <br>
                                    <span class="heading-style back-score">Synonyms</span>
                                    <ul>
                                        {#                                        {% for word in words %}#}
                                        {#                                            <span class="text-style"><li>{{ word }}</li></span>#}
                                        {#                                        {% endfor %}#}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% comment %}for mobile view{% endcomment %}
                    <div class="effect d-block d-md-none mx-3 mb-4" style="height: 450px" onclick="flip()">
                        <div class="card-container">
                            <div class="card">
                                <div class="front bg-info">
                            <span class="word-style">
                                Loading...
                            </span>
                                </div>
                                <div class="back my-secondary">
                                    <span class="heading-style back-head">Meaning</span>
                                    <p class="text-style back-desc">
                                        ["to choose not to do or have something : to refrain deliberately and often with
                                        an effort of self-denial from an action or practice","to choose not to vote"]}]
                                    </p>
                                    <br>
                                    <span class="heading-style back-score">Synonyms</span>
                                    <ul>
                                        {#                                        {% for word in words %}#}
                                        {#                                            <span class="text-style"><li>{{ word }}</li></span>#}
                                        {#                                        {% endfor %}#}
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col align-self-center d-none d-md-block">
                    <div class="row justify-content-center">
                        <button type="button" onclick="this.blur()" class="btn butn-lg btn-success py-3">I knew
                            this word
                        </button>
                    </div>
                    <div class="row mt-3 justify-content-center">
                        <button type="button" onclick="this.blur()" class="btn butn-lg btn-danger py-3">I didn't
                            know this word
                        </button>
                    </div>
                    <div class="row mt-5 justify-content-center">
                        {% load static %}
                        <a href="https://www.dictionary.com/browse/abstain#wordOrigin">
                            <img src="{% static 'images/dictionary.png' %}" alt="dictionary.com meaning"
                                 class="img-thumbnail" title="Word Origin and Examples from Dictionary.com">
                        </a>
                    </div>
                </div>
                {% comment %}Mobile View{% endcomment %}
                <div class="col offset-1 d-block d-md-none">
                    <div class="row justify-content-start">
                        <button type="button" onclick="this.blur()" class="btn butn-lg btn-success py-3">I knew
                            this word
                        </button>
                    </div>
                    <div class="row mt-3 justify-content-start">
                        <button type="button"id="danger"  onclick="this.blur()" class="btn butn-lg btn-danger py-3">I didn't
                            know this word
                        </button>
                    </div>
                    <div class="row mt-3 justify-content-start">
                        <a href="https://www.dictionary.com/browse/abstain#wordOrigin" role="button"
                           onclick="this.blur()" class="btn butn-lg btn-info py-3">Word Origin from
                            Dictionary.com
                        </a>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <script type="text/javascript">
        function flip() {
            $('.card').toggleClass('flipped');
        }

        window.onload = function () {
            function displayResult() {
                $('.word-style').text("Flip For Score");
                $('.btn-success').prop('disabled','true');
                $('.btn-danger').prop('disabled','true');
                percentage = Math.round(score/words.length * 100);
                console.log(percentage);
                if (percentage <= 20) {
                    $('.back-head').text("Ignominious!");
                    $('.back-desc').html(
                        "Seems you gave this test perfunctorily. You need a lot of practice." +
                        "But it is fine, it is always better to start late than never.<br>Good Luck!");
                    $('.back-score').text("Score: "+score+"/"+words.length);
                } else if (percentage > 20 && percentage <= 40) {
                    $('.back-head').text("Prosaic");
                    $('.back-desc').html(
                        "You'll need to practise vocabulary more" +
                        " religiously or you'll remain a dilettante. Hope you do a lot better" +
                        " in your next attempt.<br>Good Luck!");
                    $('.back-score').text("Score: "+score+"/"+words.length);
                } else if (percentage > 40 && percentage <= 90) {
                    $('.back-head').text("Approbatory");
                    $('.back-desc').html(
                        "Great! If you remain inexorable in your quest to improve your vocabulary," +
                        " you are bound to reach great heights. Keep trying until you get a perfect" +
                        "score .<br>Good Luck!"
                    );
                    $('.back-score').text("Score: "+score+"/"+words.length);
                } else {
                    $('.back-head').text("Stupendous!!");
                    $('.back-desc').html(
                        "That is one battle won. Revise the words you learn regularly and you'll win the" +
                        " war that will ultimately make you a vocabulary cognoscenti.<br>Good Luck!"
                    );
                    $('.back-score').text("Score: "+score+"/"+words.length);
                }
                $('.btn-info').text('Retake the test').prop('href', '.');
            }
            function loadNextWord(word) {
                $.ajax({
                    type:'POST',
                    url:'',
                    data: {
                        'csrfmiddlewaretoken': '{{ csrf_token }}',
                        'current_word': word,
                    },
                    beforeSend: function () {
                        $('.word-style').text("Loading..");
                        $('.btn-success').prop('disabled','true');
                        $('.btn-danger').prop('disabled','true');
                        $('.btn-info').addClass('disabled')
                    },
                    success: function (context) {
                        let meanings = context.meanings;
                        let synonyms = context.synonyms;
                        console.log(meanings);
                        $('.btn-success').removeAttr('disabled');
                        $('.btn-danger').removeAttr('disabled');
                        $('.btn-info').removeClass('disabled');
                        word_counter += 1;
                        $('.word-style').text(word_counter.toString() + "." + words[word_counter - 1]);
                        $('.back-desc').html(meanings);
                        $('.back-score').empty();
                        var list = document.createElement('ul');
                        for (var i = 0; i < synonyms.length; i++) {
                            // Create the list item:
                            var item = document.createElement('li');

                            // Set its contents:
                            item.appendChild(document.createTextNode(synonyms[i]));

                            // Add it to the list:
                            list.appendChild(item);
                        }
                        $('.back-score').append(list)
                    },
                    error: function (jqXHR, exception) {
                        var msg = '';
                        if (jqXHR.status === 0) {
                            msg = 'Not connect.\n Verify Network.';
                        } else if (jqXHR.status == 404) {
                            msg = 'Requested page not found. [404]';
                        } else if (jqXHR.status == 500) {
                            msg = 'Internal Server Error [500].';
                        } else if (exception === 'parsererror') {
                            msg = 'Requested JSON parse failed.';
                        } else if (exception === 'timeout') {
                            msg = 'Time out error.';
                        } else if (exception === 'abort') {
                            msg = 'Ajax request aborted.';
                        } else {
                            msg = 'Uncaught Error.\n' + jqXHR.responseText;
                        }
                        console.log(msg);
                        alert("Error "+msg+" Please Try Again Later!")
                    },
                });
            }
            let word_counter = 1;
            let score = 0;
            let words = {{ words|safe }};
            let meanings = "{{ first_meanings }}";
            let synonyms = {{ first_synonyms|safe }};
            console.log(words);
            console.log(words.length);
            $('.word-style').text(word_counter.toString() + "." + words[0]);
            $('.back-desc').html(meanings);
            var list = document.createElement('ul');
            for (var i = 0; i < synonyms.length; i++) {
                // Create the list item:
                var item = document.createElement('li');

                // Set its contents:
                item.appendChild(document.createTextNode(synonyms[i]));

                // Add it to the list:
                list.appendChild(item);
            };
            $('.back-score').append(list);
            $('.btn-success').click(function () {
                score += 1;
                if (word_counter < words.length) {
                    loadNextWord(words[word_counter])
                } else {
                    displayResult(words[word_counter - 1])
                }
            });
            $('.btn-danger').click(function () {
                if (word_counter < words.length) {
                    loadNextWord(words[word_counter])
                } else {
                    displayResult(words[word_counter - 1])
                }
            });

        }
    </script>
{% endblock %}

{% block footer %}
    <!-- Footer -->
    <footer class="py-5 bg-dark d-none d-md-block"
            style="position: fixed;bottom: 0;width: 100%;">
        <div class="container">
            <p class="m-0 text-center text-white">Copyright &copy; Kewal Shah 2019</p>
        </div>
        <!-- /.container -->
    </footer>
    <!-- Footer -->
    <footer class="py-5 bg-dark d-block d-md-none">
        <div class="container">
            <p class="m-0 text-center text-white">Copyright &copy; Kewal Shah 2019</p>
        </div>
        <!-- /.container -->
    </footer>
{% endblock %}